<html>
    <head></head>
    <body onload="loadDefaultData()">
        <form action="" onSubmit="return start_ap()">
            <input type="text" id="ssid" value="TEST">
            <input type="submit" value="Start AP">
        </form>
        <button onclick="refresh_ap_list()">Refresh available AP</button>
        <form action="" onSubmit="return start_ftm()">
            <label for="responder_ssid">Responder SSID: </label>
            <select id="responder_ssid">
                <option>Please refresh available AP</option> 
                <!-- populate in JS -->
            </select>
            <br />
            <input type="checkbox" id="raw_values">
            <label for="raw_values">Raw Values</label>
            <br />
            <input type="submit" value="Start FTM">
        </form>
        <h1>Results</h1>
        <div name="FTM results" id="results">
        </div>
        <script>
            function refresh_ap_list(){
                fetch("/api/v1/ftm/ssid-list")
                    .then((response) => response.json())
                    .then(function(data){
                        let select_ssid = document.getElementById("responder_ssid");
                        while(select_ssid.hasChildNodes()){
                            select_ssid.removeChild(select_ssid.firstChild);
                        }
                        data.ap_list.forEach((ap_entry) => {
                            let option = document.createElement("option");
                            option.value = ap_entry.SSID;
                            option.innerHTML = `[${ap_entry.ftm_responder ? "x" : " "}] ` + ap_entry.SSID + ` [${ap_entry.RSSI}]`;
                            select_ssid.appendChild(option);
                        });
                    });
            }
            function start_ap(){
                // HTTP POST request
                const ssid = document.getElementById('ssid').value;
                let data = {"SSID": ssid};
                fetch("/api/v1/ftm/start_ap", {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                return false; // avoid refreshing site
            }
            function start_ftm(){
                // TODO: start FTM
                let responder_ssid = document.getElementById('responder_ssid').value;
                fetch("/api/v1/ftm/measure_distance?" + new URLSearchParams({
                    ssid: responder_ssid
                }))
                    .then((response) => response.json())
                    .then(function(data){
                        let results = document.getElementById('results');
                        let result = document.createElement("div");
                        result.innerHTML = data.dist_est;
                        results.appendChild(result);
                    });
                return false; // avoid refreshing site
            }
            function loadDefaultData(){
                refresh_ap_list();
            }
        </script>
    </body>
</html>